Cluster Launcher Errors
Author: Balaji Veeramani
Date: Feb 8, 2022
Introduction
This document describes the errors I ran into while trying to set up my developer environment on a Ray cluster. I used Python 3.8.12 and Ray 1.10.0.
Errors
Invalid AMI on us-east-1
config.yaml
cluster_name: balajis-cluster

provider:
   type: aws
   region: us-east-1


Partial Traceback
Checking AWS environment settings
AWS config
 IAM Profile: ray-autoscaler-v1 [default]
 EC2 Key pair (all available node types): ray-autoscaler_23_us-east-1 [default]
 VPC Subnets (all available node types): subnet-02911df6017c32149, subnet-0ad65b41281d9856e, subnet-0a1df51b483ae1333, subnet-0397c860425416be5, subnet-064c83f6e01f942a4, subnet-070bd7c49ff72dcff [default]
 EC2 Security groups (all available node types): sg-0731e1efbaedc480f [default]
 EC2 AMI (all available node types): ami-0a2363a9cff180a64

No head node found. Launching a new cluster. Confirm [y/N]: y

Acquiring an up-to-date head node
 create_instances: Attempt failed with An error occurred (InvalidAMIID.NotFound) when calling the RunInstances operation: The image id '[ami-0a2363a9cff180a64]' does not exist, retrying.
 create_instances: Attempt failed with An error occurred (InvalidAMIID.NotFound) when calling the RunInstances operation: The image id '[ami-0a2363a9cff180a64]' does not exist, retrying.
 create_instances: Attempt failed with An error occurred (InvalidAMIID.NotFound) when calling the RunInstances operation: The image id '[ami-0a2363a9cff180a64]' does not exist, retrying.
 create_instances: Attempt failed with An error occurred (InvalidAMIID.NotFound) when calling the RunInstances operation: The image id '[ami-0a2363a9cff180a64]' does not exist, retrying.
 create_instances: Attempt failed with An error occurred (InvalidAMIID.NotFound) when calling the RunInstances operation: The image id '[ami-0a2363a9cff180a64]' does not exist, retrying.
 Failed to launch instances. Max attempts exceeded.
Traceback (most recent call last):
 File "/Users/balaji/.pyenv/versions/3.8.12/bin/ray", line 8, in <module>
   sys.exit(main())
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/ray/scripts/scripts.py", line 1989, in main
   return cli()
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
   return self.main(*args, **kwargs)
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/click/core.py", line 1053, in main
   rv = self.invoke(ctx)
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
   return _process_result(sub_ctx.command.invoke(sub_ctx))
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
   return ctx.invoke(self.callback, **ctx.params)
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/click/core.py", line 754, in invoke
   return __callback(*args, **kwargs)
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/ray/scripts/scripts.py", line 971, in up
   create_or_update_cluster(
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/ray/autoscaler/_private/commands.py", line 236, in create_or_update_cluster
   get_or_create_head_node(config, config_file, no_restart, restart_only, yes,
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/ray/autoscaler/_private/commands.py", line 635, in get_or_create_head_node
   provider.create_node(head_node_config, head_node_tags, 1)
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/ray/autoscaler/_private/aws/node_provider.py", line 310, in create_node
   created_nodes_dict = self._create_node(node_config, tags, count)
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/ray/autoscaler/_private/aws/node_provider.py", line 437, in _create_node
   cli_logger.abort(
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/ray/autoscaler/_private/cli_logger.py", line 603, in abort
   raise exc
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/ray/autoscaler/_private/aws/node_provider.py", line 408, in _create_node
   created = self.ec2_fail_fast.create_instances(**conf)
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/boto3/resources/factory.py", line 520, in do_action
   response = action(self, *args, **kwargs)
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/boto3/resources/action.py", line 83, in __call__
   response = getattr(parent.meta.client, operation_name)(*args, **params)
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/botocore/client.py", line 391, in _api_call
   return self._make_api_call(operation_name, kwargs)
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/botocore/client.py", line 719, in _make_api_call
   raise error_class(parsed_response, operation_name)
botocore.exceptions.ClientError: An error occurred (InvalidAMIID.NotFound) when calling the RunInstances operation: The image id '[ami-0a2363a9cff180a64]' does not exist


Invalid AMI on us-west-1
config.yaml
cluster_name: balajis-cluster

provider:
   type: aws
   region: us-west-1


Partial Traceback
Checking AWS environment settings
AWS config
 IAM Profile: ray-autoscaler-v1 [default]
 EC2 Key pair (all available node types): ray-autoscaler_26_us-west-1 [default]
 VPC Subnets (all available node types): subnet-03b5e778dcd36c1fb, subnet-04f8c6515ba8442ef [default]
 EC2 Security groups (all available node types): sg-0b0c64559c728809b [default]
 EC2 AMI (all available node types): ami-0a2363a9cff180a64

No head node found. Launching a new cluster. Confirm [y/N]: y

Acquiring an up-to-date head node
 create_instances: Attempt failed with An error occurred (InvalidAMIID.NotFound) when calling the RunInstances operation: The image id '[ami-0a2363a9cff180a64]' does not exist, retrying.
 create_instances: Attempt failed with An error occurred (InvalidAMIID.NotFound) when calling the RunInstances operation: The image id '[ami-0a2363a9cff180a64]' does not exist, retrying.
 create_instances: Attempt failed with An error occurred (InvalidAMIID.NotFound) when calling the RunInstances operation: The image id '[ami-0a2363a9cff180a64]' does not exist, retrying.
 create_instances: Attempt failed with An error occurred (InvalidAMIID.NotFound) when calling the RunInstances operation: The image id '[ami-0a2363a9cff180a64]' does not exist, retrying.
 Failed to launch instances. Max attempts exceeded.
Traceback (most recent call last):
 File "/Users/balaji/.pyenv/versions/3.8.12/bin/ray", line 8, in <module>
   sys.exit(main())
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/ray/scripts/scripts.py", line 1989, in main
   return cli()
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/click/core.py", line 1128, in __call__
   return self.main(*args, **kwargs)
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/click/core.py", line 1053, in main
   rv = self.invoke(ctx)
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/click/core.py", line 1659, in invoke
   return _process_result(sub_ctx.command.invoke(sub_ctx))
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/click/core.py", line 1395, in invoke
   return ctx.invoke(self.callback, **ctx.params)
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/click/core.py", line 754, in invoke
   return __callback(*args, **kwargs)
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/ray/scripts/scripts.py", line 971, in up
   create_or_update_cluster(
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/ray/autoscaler/_private/commands.py", line 236, in create_or_update_cluster
   get_or_create_head_node(config, config_file, no_restart, restart_only, yes,
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/ray/autoscaler/_private/commands.py", line 635, in get_or_create_head_node
   provider.create_node(head_node_config, head_node_tags, 1)
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/ray/autoscaler/_private/aws/node_provider.py", line 310, in create_node
   created_nodes_dict = self._create_node(node_config, tags, count)
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/ray/autoscaler/_private/aws/node_provider.py", line 437, in _create_node
   cli_logger.abort(
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/ray/autoscaler/_private/cli_logger.py", line 603, in abort
   raise exc
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/ray/autoscaler/_private/aws/node_provider.py", line 408, in _create_node
   created = self.ec2_fail_fast.create_instances(**conf)
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/boto3/resources/factory.py", line 520, in do_action
   response = action(self, *args, **kwargs)
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/boto3/resources/action.py", line 83, in __call__
   response = getattr(parent.meta.client, operation_name)(*args, **params)
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/botocore/client.py", line 391, in _api_call
   return self._make_api_call(operation_name, kwargs)
 File "/Users/balaji/.pyenv/versions/3.8.12/lib/python3.8/site-packages/botocore/client.py", line 719, in _make_api_call
   raise error_class(parsed_response, operation_name)
botocore.exceptions.ClientError: An error occurred (InvalidAMIID.NotFound) when calling the RunInstances operation: The image id '[ami-0a2363a9cff180a64]' does not exist


Private key file not found on us-west-2
config.yaml
cluster_name: balajis-cluster

provider:
   type: aws
   region: us-west-2


Partial Traceback
Checking AWS environment settings
Private key file /Users/balaji/.ssh/ray-autoscaler_29_us-west-2.pem not found for ray-autoscaler_29_us-west-2

No module named YAML
config.yaml
cluster_name: balajis-cluster

provider:
   type: aws
   region: us-west-2

auth:
   ssh_user: ubuntu
   ssh_private_key: ~/.ssh/id

available_node_types:
   ray.head.default:
       node_config:
           KeyName: balajis-key-pair
           InstanceType: m5.large
       resources: {}
   ray.worker.default:
       min_workers: 1
       max_workers: 1
       node_config:
           KeyName: balajis-key-pair
           InstanceType: p3.16xlarge
       resources: {}

head_node_type: ray.head.default


Partial Traceback
 [7/7] Starting the Ray runtime
Traceback (most recent call last):
 File "/home/ubuntu/anaconda3/bin/ray", line 5, in <module>
   from ray.scripts.scripts import main
 File "/home/ubuntu/anaconda3/lib/python3.7/site-packages/ray/__init__.py", line 108, in <module>
   import ray._raylet  # noqa: E402
 File "python/ray/_raylet.pyx", line 127, in init ray._raylet
 File "/home/ubuntu/anaconda3/lib/python3.7/site-packages/ray/util/__init__.py", line 16, in <module>
   from ray.util import rpdb as pdb
 File "/home/ubuntu/anaconda3/lib/python3.7/site-packages/ray/util/rpdb.py", line 22, in <module>
   from ray.experimental.internal_kv import _internal_kv_del, _internal_kv_put
 File "/home/ubuntu/anaconda3/lib/python3.7/site-packages/ray/experimental/__init__.py", line 2, in <module>
   from ray.experimental.packaging.load_package import load_package
 File "/home/ubuntu/anaconda3/lib/python3.7/site-packages/ray/experimental/packaging/load_package.py", line 19, in <module>
   import yaml
ModuleNotFoundError: No module named 'yaml'
Shared connection to 35.87.52.242 closed.
 New status: update-failed
 !!!
 SSH command failed.
 !!!

 Failed to setup head node.



